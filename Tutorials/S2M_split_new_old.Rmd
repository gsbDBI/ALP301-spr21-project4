---
title: "S2M_Split_into_new_old"
output: html_document
    highlight: haddock
    number_sections: no
    theme: journal
    toc: yes
    toc_depth: 2
    toc_float: yes
  word_document:
    toc: yes
    toc_depth: '2'
  pdf_document:
    toc: yes
    toc_depth: '2'
date: "April 2021"
---

```{r, message = FALSE, warning = FALSE}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse)
pacman::p_load(here)
pacman::p_load(lmtest)
pacman::p_load(glue)
pacman::p_load(broom)
pacman::p_load(ri2)
pacman::p_load(margins)
pacman::p_load(glmnet) 
pacman::p_load(kableExtra)
pacman::p_load(stargazer)
pacman::p_load(knitr)
pacman::p_load(doParallel)
pacman::p_load(corrplot)

rm(list = ls())

story_info<- read_csv("Datasets/all_story_obs.csv")
utility_mat<- read_csv("Datasets/utils_mat_filtered.csv",col_types = cols(.default = col_double()))
num_cols <- 2527
child_ids<-as.integer(utility_mat$child_id_code)
story_ids<-as.integer(colnames(utility_mat[,3:num_cols]))

#filter down from 2500+ stories to 1087 stories we have info on
stories_with_text<-(story_ids %in% story_info$story_id_code)
utility_matrix<-utility_mat[,3:num_cols]
utility_matrix<-utility_matrix[,stories_with_text]
story_ids<-colnames(utility_matrix)

#filter by number of "0" interactions because the opposite of that is interactions (.3, .5, 1). High 0 number means new user.
utility_matrix_old_activity <- utility_matrix[ which(rowSums(is.na(utility_matrix))<=1062),]
utility_matrix_new_activity <- utility_matrix[ which(rowSums(is.na(utility_matrix))>1062),]

#add 0s instead of NAs
utility_matrix_old_activity[is.na(utility_matrix_old_activity)]<-0.0
utility_matrix_new_activity[is.na(utility_matrix_new_activity)]<-0.0


```

Split into new vs. old datasets

```{r}

#check that filtering is working
mean(rowSums(utility_matrix_old_activity == 0))
mean(rowSums(utility_matrix_new_activity == 0))
summary(rowSums(utility_matrix_old_activity == 0))
summary(rowSums(utility_matrix_new_activity == 0))

#making old matrix
utility_matrix_old_activity<-as.matrix(utility_matrix_old_activity)

#making new matrix
utility_matrix_new_activity<-as.matrix(utility_matrix_new_activity)

rm(utility_mat)  # this variable is no longer needed
```

```{r}
source("../RecSys/get_item_scores.R", local = knitr:knit_global())
```

```{r old users ubcf create recs}

```

```{r old users ubcf all-but-k evaluation}

```

```{r old users ubcf all-but-k fold}

```

```{r old users ubcf diversity}

```

```{r old users ubcf engagement metric}

```

```{r old users ubcf cold start analysis}

```

